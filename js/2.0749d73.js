(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{726:function(t,e,s){"use strict";s.r(e),function(t){s.d(e,"default",(function(){return U}));var a=s(15),n=s.n(a),r=s(18),i=s.n(r),d=(s(23),s(40),s(83),s(1)),o=s(289),c=s(147),l=s.n(c),h=(s(300),s(302)),u=s.n(h),m=s(91),p=s.n(m),b=s(305),f=s.n(b),g=s(306),j=s.n(g),O=s(215),y=s(123),w=s.n(y),x=s(301),F=s.n(x),v=s(303),I=s.n(v),S=s(304),M=s.n(S),T=s(2),k=s(3),N=s(307),D=(s(727),s(248)),q=s.n(D),L=s(247),A=s.n(L),C=s(0);function P(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function _(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?P(Object(s),!0).forEach((function(e){i()(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):P(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}let B={backgroundImage:"url(".concat(q.a,")")},R={backgroundImage:"url(".concat(A.a,")")};class U extends d.Component{constructor(e){super(e),this.componentDidMount=async()=>{console.log(t.isPC),await this.initinfo()},this.initinfo=async()=>{window.ethereum&&await T.b.eth.getAccounts((t,e)=>{this.setState({address:e[0]})});let t=location.hash.split("?")[1].split("&"),e={};for(let s=0;s<t.length;s++){let a=t[s].split("=");e[a[0]]=a[1]}let s=JSON.parse(decodeURI(e.friendInfo)),a=JSON.parse(decodeURI(e.landIndex));console.log(s),this.setState({ingoA:s,balanceOf:s.landList.length,_address:s.address,nFT:a,name:s.address.slice(-4),_landAddress:s.landList[a].address}),this.setHomeDate(s.landList[a].id)},this.setHomeDate=async t=>{console.log(t);const e=new T.b.BatchRequest,s=await Object(k.g)();e.add(T.a.MetaLand.methods.balanceOf(this.state._address).call.request()),e.requestManager.sendBatch(e.requests,async(e,a)=>{if(!e){const e=("string"==typeof a[0]?a[0]:a[0].result).decode(["uint256"]),n=await this.getLandList(e),r=await this.getLandInfoList(n);let i=0,d=r[0].supply.fromWei().toFixed(2),o=17,c=!1,l=!1,h="";t=t||n[0].id;for(let a=0;a<e;a++)if(t==n[a].id&&(d=r[a].supply.fromWei().toFixed(2),r[a].isActive)){o=18,-1!=this.state.timer1&&clearInterval(this.state.timer1),this.countdown(parseInt(r[a].lastTime)),s>parseInt(r[a].lastTime)+86400&&(o=19,c=!0),s>parseInt(r[a].lastTime)+2592e3&&(l=!0),h=n[a].address,i=(await T.a.MetaFarm.methods.harvestInfo(n[a].address).call({from:"0x000000000000000000000000000000000000dead"}))[0].fromWei().toFixed(2)}await this.setState({canTake:c,iscanTake:l,landSupply:d,currSupply:i,landStatus:o,landId:t,_landAddress:h});let u=setInterval(async()=>{this.setState({landImg2state:!1,landImg1state:!1}),clearInterval(u)},2500)}})},this.getLandList=t=>new Promise(e=>{const s=new T.b.BatchRequest;for(let e=0;e<t;e++)s.add(T.a.MetaLand.methods.tokenOfOwnerByIndex(this.state._address,e).call.request());s.requestManager.sendBatch(s.requests,(t,s)=>{t||e(s.map(t=>{const e=("string"==typeof t?t:t.result).decode(["uint256"]);return{id:e,address:e.toAddress()}}))})}),this.getLandInfoList=t=>new Promise(e=>{const s=new T.b.BatchRequest;for(let e=0;e<t.length;e++)s.add(T.a.MetaFarm.methods.LandFarmInfo(t[e].address).call.request()),s.add(T.a.MetaFarm.methods.landIsActived(t[e].address).call.request());s.requestManager.sendBatch(s.requests,(t,s)=>{if(!t){const t=[_(_({},("string"==typeof s[0]?s[0]:s[0].result).decode([{name:"supply",type:"uint256"},{name:"reward",type:"uint256"},{name:"taked",type:"uint256"},{name:"takedUSD",type:"uint256"},{name:"rewardDebt",type:"uint256"},{name:"lastTime",type:"uint256"}])),{},{isActive:s[1].result.decode(["bool"])})];for(let e=2;e<s.length;e+=2)t.push(_(_({},s[e].result.decode([{name:"supply",type:"uint256"},{name:"reward",type:"uint256"},{name:"taked",type:"uint256"},{name:"takedUSD",type:"uint256"},{name:"rewardDebt",type:"uint256"},{name:"lastTime",type:"uint256"}])),{},{isActive:s[e+1].result.decode(["bool"])}));e(t)}})}),this.countdown=async t=>{console.log(t);let e=t+86400,s=e-t,a=w.a,n=setInterval(async()=>{const n=await Object(k.g)();if(n>e)return this.setState({tree:M.a,percentage:100,hour:"00",minute:"00",second:"00",showCountdown:!1}),clearInterval(this.state.timer1);n>t+57600?a=I.a:n>t+28800&&(a=F.a);let r=e-n,i=Math.floor(r/3600),d=Math.floor((r-3600*i)/60),o=r-3600*i-60*d;this.setState({tree:a,showCountdown:!0,percentage:(s-r)/s*100,hour:i<10?"0".concat(i):i,minute:d<10?"0".concat(d):d,second:o<10?"0".concat(o):o})},1e3);this.setState({timer1:n})},this.harvest=async()=>{if(this.state.showCountdown)return Object(k.h)(t.t("land.tips3"),"error");if(0==this.state.iscanTake)return Object(k.h)(t.t("Friends.tips10"),"error");const e=new T.b.BatchRequest;e.add(T.a.MetaFarm.methods.LandFarmInfo(this.state._landAddress).call.request()),e.add(T.a.MetaTax.methods.balanceOf(this.state._address).call.request()),e.add(T.a.MetaFarm.methods.harvestInfo(this.state._landAddress).call.request({from:"0x000000000000000000000000000000000000dead"})),e.add(T.a.MetaFarm.methods.userTakeUSD(this.state._address).call.request()),e.add(T.a.MetaFarm.methods.userMaxEarnUSD(this.state._address).call.request()),e.requestManager.sendBatch(e.requests,async(e,s)=>{if(!e){const{supply:e}=("string"==typeof s[0]?s[0]:s[0].result).decode([{name:"supply",type:"uint256"},{name:"reward",type:"uint256"},{name:"taked",type:"uint256"},{name:"takedUSD",type:"uint256"},{name:"rewardDebt",type:"uint256"},{name:"lastTime",type:"uint256"}]),a=s[1].result.toBN(),n=s[2].result.decode(["uint256","uint256","uint256"]),r=n[2],i=n[1],d=s[3].result.toBN(),o=s[4].result.toBN().toFixed(),c=await T.a.MinistryLandResources.methods.tokenAmount(T.a.MetaPoint.options.address,i).call(),l=d.plus(c).toFixed(0);if(a.lt(r))return Object(k.h)(t.t("Friends.tips4"),"error");if(n[1].toBN().gt(e))return Object(k.h)(t.t("Friends.tips6"),"error");if(Number(l)>=Number(o))return Object(k.h)(t.t("Friends.tips9"),"error");const h=T.a.MetaFarm.methods.harvest(this.state._landAddress);h.call({from:t.$address},e=>{console.log(e),e||h.send({from:t.$address}).on("receipt",()=>{Object(k.h)(t.t("land.tips5"),"success"),this.initinfo()}).on("error",()=>{Object(k.h)(t.t("cancel"),"error"),this.setState({loading:!1})})})}})},this.next=async()=>{let e=await T.a.MetaLand.methods.balanceOf(this.state._address).call(),s=this.state.nFT;if(e-1==s)return Object(k.h)(t.t("Friends.tips8"),"error");s++,this.setState({nFT:s,landImg1state:!0}),this.setHomeDate(this.state.ingoA.landList[this.state.nFT].id)},this.prev=async()=>{let e=this.state.nFT;if(0!=e&&e--,this.setState({nFT:e}),this.state.nFT<=0)return this.setState({nFT:0}),this.setHomeDate(this.state.ingoA.landList[this.state.nFT].id),Object(k.h)(t.t("Friends.tips8"),"error");this.setState({nFT:e,landImg2state:!0}),this.setHomeDate(this.state.ingoA.landList[e].id)},this.Continuetovisit=()=>{this.warehouseModal.showModal()},this.state={isShow:!0,isShow1:!0,landImg1state:!1,landImg2state:!1,hour:"00",minute:"00",second:"00",percentage:0,ManorNumber:0,address:null,landAddress:null,tree:w.a,showCountdown:!0,timer1:-1,capacitybalanceOf:0,showData:!1,_address:null,landId:0,landSupply:0,currSupply:0,landStatus:17,canTake:!1,iscanTake:!1,_landAddress:null,nFT:0,harvestInfo1:null,MetaTaxbalanceOf:0,balanceOf:0,name:null,ingoA:null}}toggleShowDate(){this.setState({showData:!this.state.showData})}render(){const e=this.state;return Object(C.jsx)("div",{className:"Friendss",style:t.isPC?B:R,children:Object(C.jsxs)("div",{className:"Friendss1",children:[Object(C.jsx)(o.a,{}),Object(C.jsx)(N.a,{onRef:t=>this.warehouseModal=t,initinfo:this.initinfo}),Object(C.jsxs)("div",{className:"leftimgxs",children:[0==this.state.nFT?Object(C.jsx)("div",{}):Object(C.jsx)("img",{onClick:this.prev,src:l.a,alt:""}),this.state.nFT==this.state.balanceOf-1?Object(C.jsx)("div",{}):Object(C.jsx)("img",{onClick:this.next,src:u.a,alt:""})]}),Object(C.jsxs)("div",{className:e.landImg1state?"Friendssland2 landImg1rigthtstate":e.landImg2state?"Friendssland2 landImg1leftstate":"Friendssland2",children:[Object(C.jsx)("img",{src:p.a}),Object(C.jsxs)("div",{className:"CountdownProgress",children:[Object(C.jsx)("img",{className:"treeImg",src:e.tree,onClick:this.harvest}),Object(C.jsxs)("div",{className:"energy",onClick:this.harvest,children:[Object(C.jsxs)("div",{className:"energy1",children:[Object(C.jsx)("img",{className:e.showCountdown?"tenergy1":"",src:f.a,alt:""}),Object(C.jsxs)("div",{className:"pot",children:[Object(C.jsx)("span",{children:e.currSupply}),Object(C.jsx)("span",{children:"pot"})]})]}),e.showCountdown?"":Object(C.jsx)("img",{src:j.a,alt:""})]})]}),Object(C.jsxs)("div",{className:"icon7",children:[Object(C.jsx)(O.a,{to:{pathname:"/"},className:"icon1",children:Object(C.jsx)(n.a,{className:"icon",children:t.t("Friends.text1")})}),Object(C.jsx)(n.a,{className:"icon2",onClick:this.Continuetovisit,children:t.t("Friends.text2")})]})]})]})})}}}.call(this,s(22))},727:function(t,e,s){}}]);